<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Manage Menu</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        table { border-collapse: collapse; width: 100%; margin-top: 10px; }
        th, td { border: 1px solid #ddd; padding: 8px; }
        th { background: #f4f4f4; }
        input, button { padding: 6px; margin: 2px; }
        form { margin-bottom: 20px; }
    </style>
</head>
<body>
<h1>Manage Menu</h1>

<!-- Create -->
<h2>Add New Item</h2>
<form id="createForm">
    <input type="text" id="createName" placeholder="Name" required>
    <input type="number" id="createPrice" placeholder="Price" required>
    <input type="text" id="createDesc" placeholder="Description" required>
    <label>
        Available
        <input type="checkbox" id="createAvail" checked>
    </label>
    <button type="submit">Add Item</button>
</form>

<!-- Read & Update & Delete -->
<h2>Existing Items</h2>
<table id="menuTable">
    <thead>
    <tr>
        <th>ID</th>
        <th>Name</th>
        <th>Price</th>
        <th>Description</th>
        <th>Available</th>
        <th>Actions</th>
    </tr>
    </thead>
    <tbody></tbody>
</table>

<script>
    const API = '/menu';

    // Fetch & render
    async function loadMenu() {
        const res = await fetch(API);
        const data = await res.json();
        const tbody = document.querySelector('#menuTable tbody');
        tbody.innerHTML = '';
        data
            // filter out categories (they wonâ€™t have a price field)
            .filter(item => typeof item.price !== 'undefined')
            .forEach(item => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
            <td>${item.id}</td>
            <td><input data-field="name" value="${item.name}"></td>
            <td><input data-field="price" type="number" value="${item.price}"></td>
            <td><input data-field="description" value="${item.description}"></td>
            <td><input data-field="available" type="checkbox" ${item.available ? 'checked': ''}></td>
            <td>
              <button data-action="update" data-id="${item.id}">Update</button>
              <button data-action="delete" data-id="${item.id}">Delete</button>
            </td>`;
                tbody.appendChild(tr);
            });
    }

    // Create handler
    document.getElementById('createForm').addEventListener('submit', async e => {
        e.preventDefault();
        const payload = {
            name: document.getElementById('createName').value,
            price: parseFloat(document.getElementById('createPrice').value),
            description: document.getElementById('createDesc').value,
            available: document.getElementById('createAvail').checked
        };
        await fetch(`${API}/items`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
        });
        e.target.reset();
        loadMenu();
    });

    // Update/Delete via event delegation
    document.querySelector('#menuTable').addEventListener('click', async e => {
        if (e.target.tagName !== 'BUTTON') return;
        const id = e.target.dataset.id;
        const action = e.target.dataset.action;
        if (action === 'delete') {
            await fetch(`${API}/items/${id}`, { method: 'DELETE' });
        } else if (action === 'update') {
            const tr = e.target.closest('tr');
            const updated = {
                name: tr.querySelector('input[data-field="name"]').value,
                price: parseFloat(tr.querySelector('input[data-field="price"]').value),
                description: tr.querySelector('input[data-field="description"]').value,
                available: tr.querySelector('input[data-field="available"]').checked
            };
            await fetch(`${API}/items/${id}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(updated)
            });
        }
        loadMenu();
    });

    // Initial load
    loadMenu();
</script>
</body>
</html>
